@model BloodDonation.Models.AddDonorViewModel
@{
    ViewData["Title"] = ViewBag.DonorId != null ? "Edit Donor" : "Add New Donor";
}
@section PageHeader {
    <button onclick="window.location.href='@Url.Action("DonorManagement", "Admin")'"
            class="flex items-center gap-2 rounded-full border border-gray-200 dark:border-white/10 px-4 py-2 text-sm font-medium text-gray-700 dark:text-gray-200 hover:bg-gray-50 dark:hover:bg-white/10 transition">
        <span class="material-symbols-outlined text-[18px]">arrow_back</span>
        Back to Donor Management
    </button>

    <span class="ml-4 text-lg font-bold">
        Add New Donor
    </span>
}

<div class="max-w-5xl mx-auto">
    <div class="bg-white dark:bg-background-dark rounded-xl shadow-sm border border-gray-200 dark:border-white/5 overflow-hidden">
        <div class="px-6 py-5 border-b border-gray-100 dark:border-white/5 flex flex-col gap-1">
            <h1 class="text-xl font-bold text-gray-900 dark:text-white">@(ViewBag.DonorId != null ? "Edit Donor Information" : "New Donor Registration")</h1>
            <p class="text-sm text-gray-500">Please fill in the donor information accurately. Fields marked with * are mandatory.</p>
        </div>
        <form asp-action="@(ViewBag.DonorId != null ? "EditDonor" : "AddDonor")" asp-controller="Admin" method="post" class="p-6 md:p-8 space-y-8">
            @if (ViewBag.DonorId != null)
            {
                <input type="hidden" name="id" value="@ViewBag.DonorId" />
            }
            @Html.AntiForgeryToken()
            <div asp-validation-summary="ModelOnly" class="text-red-600 text-sm mb-4"></div>
            <section>
                <div class="flex items-center gap-3 mb-5 text-gray-900 dark:text-white">
                    <div class="flex items-center justify-center size-8 rounded-full bg-blue-50 dark:bg-blue-900/20 text-blue-600 dark:text-blue-400">
                        <span class="material-symbols-outlined text-[18px]">person</span>
                    </div>
                    <h3 class="text-lg font-semibold">Personal Details</h3>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div class="space-y-1.5">
                        <label class="text-sm font-medium text-gray-700 dark:text-gray-300" asp-for="FirstName">First Name <span class="text-red-500">*</span></label>
                        <input asp-for="FirstName" class="w-full rounded-lg border-gray-300 dark:border-white/20 dark:bg-white/5 shadow-sm focus:border-primary focus:ring-primary sm:text-sm py-2.5 transition-shadow" placeholder="e.g. John" />
                        <span asp-validation-for="FirstName" class="text-red-600 text-xs"></span>
                    </div>
                    <div class="space-y-1.5">
                        <label class="text-sm font-medium text-gray-700 dark:text-gray-300" asp-for="LastName">Last Name <span class="text-red-500">*</span></label>
                        <input asp-for="LastName" class="w-full rounded-lg border-gray-300 dark:border-white/20 dark:bg-white/5 shadow-sm focus:border-primary focus:ring-primary sm:text-sm py-2.5 transition-shadow" placeholder="e.g. Doe" />
                        <span asp-validation-for="LastName" class="text-red-600 text-xs"></span>
                    </div>
                    <div class="space-y-1.5">
                        <label class="text-sm font-medium text-gray-700 dark:text-gray-300" asp-for="Email">Email Address <span class="text-red-500">*</span></label>
                        <input asp-for="Email" class="w-full rounded-lg border-gray-300 dark:border-white/20 dark:bg-white/5 shadow-sm focus:border-primary focus:ring-primary sm:text-sm py-2.5 transition-shadow" placeholder="john@example.com" type="email" />
                        <span asp-validation-for="Email" class="text-red-600 text-xs"></span>
                    </div>
                    <div class="space-y-1.5">
                        <label class="text-sm font-medium text-gray-700 dark:text-gray-300" asp-for="PhoneNumber">Phone Number</label>
                        <input asp-for="PhoneNumber" class="w-full rounded-lg border-gray-300 dark:border-white/20 dark:bg-white/5 shadow-sm focus:border-primary focus:ring-primary sm:text-sm py-2.5 transition-shadow" placeholder="+961 3 123456" type="tel" />
                        <span asp-validation-for="PhoneNumber" class="text-red-600 text-xs"></span>
                    </div>
                    <div class="space-y-1.5">
                        <label class="text-sm font-medium text-gray-700 dark:text-gray-300" asp-for="DateOfBirth">Date of Birth <span class="text-red-500">*</span></label>
                        <input asp-for="DateOfBirth" class="w-full rounded-lg border-gray-300 dark:border-white/20 dark:bg-white/5 shadow-sm focus:border-primary focus:ring-primary sm:text-sm py-2.5 transition-shadow" type="date" />
                        <span asp-validation-for="DateOfBirth" class="text-red-600 text-xs"></span>
                    </div>
                    @if (ViewBag.DonorId == null)
                    {
                        <div class="space-y-1.5">
                            <label class="text-sm font-medium text-gray-700 dark:text-gray-300" asp-for="Password">Password <span class="text-red-500">*</span></label>
                            <input asp-for="Password" class="w-full rounded-lg border-gray-300 dark:border-white/20 dark:bg-white/5 shadow-sm focus:border-primary focus:ring-primary sm:text-sm py-2.5 transition-shadow" type="password" required data-val="true" data-val-required="Password is required" data-val-minlength="Password must be at least 6 characters" data-val-minlength-min="6" />
                            <span asp-validation-for="Password" class="text-red-600 text-xs"></span>
                        </div>
                    }
                    else
                    {
                        <div class="space-y-1.5">
                            <label class="text-sm font-medium text-gray-700 dark:text-gray-300" asp-for="Password">New Password (leave empty to keep current)</label>
                            <input asp-for="Password" class="w-full rounded-lg border-gray-300 dark:border-white/20 dark:bg-white/5 shadow-sm focus:border-primary focus:ring-primary sm:text-sm py-2.5 transition-shadow" type="password" placeholder="Enter new password" data-val="false" />
                            <span asp-validation-for="Password" class="text-red-600 text-xs"></span>
                        </div>
                    }
                </div>
            </section>
            <div class="h-px bg-gray-100 dark:bg-white/5"></div>
            <section>
                <div class="flex items-center gap-3 mb-5 text-gray-900 dark:text-white">
                    <div class="flex items-center justify-center size-8 rounded-full bg-red-50 dark:bg-red-900/20 text-red-600 dark:text-red-400">
                        <span class="material-symbols-outlined text-[18px]">bloodtype</span>
                    </div>
                    <h3 class="text-lg font-semibold">Donation Information</h3>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                    <div class="space-y-1.5">
                        <label class="text-sm font-medium text-gray-700 dark:text-gray-300" asp-for="BloodTypeId">Blood Type <span class="text-red-500">*</span></label>
                        <select asp-for="BloodTypeId" class="w-full rounded-lg border-gray-300 dark:border-white/20 dark:bg-white/5 shadow-sm focus:border-primary focus:ring-primary sm:text-sm py-2.5 transition-shadow">
                            <option value="">Select Blood Type...</option>
                            @foreach (var bloodType in Model.BloodTypes)
                            {
                                <option value="@bloodType.BloodTypeId">@bloodType.Type</option>
                            }
                        </select>
                        <span asp-validation-for="BloodTypeId" class="text-red-600 text-xs"></span>
                    </div>
                    <div class="space-y-1.5">
                        <label class="text-sm font-medium text-gray-700 dark:text-gray-300" asp-for="Gender">Gender <span class="text-red-500">*</span></label>
                        <select asp-for="Gender" class="w-full rounded-lg border-gray-300 dark:border-white/20 dark:bg-white/5 shadow-sm focus:border-primary focus:ring-primary sm:text-sm py-2.5 transition-shadow">
                            <option value="">Select Gender...</option>
                            <option value="Male">Male</option>
                            <option value="Female">Female</option>
                        </select>
                        <span asp-validation-for="Gender" class="text-red-600 text-xs"></span>
                    </div>
                    <div class="space-y-1.5">
                        <label class="text-sm font-medium text-gray-700 dark:text-gray-300" asp-for="LastDonationDate">Last Donation Date</label>
                        <input asp-for="LastDonationDate" class="w-full rounded-lg border-gray-300 dark:border-white/20 dark:bg-white/5 shadow-sm focus:border-primary focus:ring-primary sm:text-sm py-2.5 transition-shadow" type="date" />
                        <p class="text-xs text-gray-500">Leave empty if first time donor</p>
                        <span asp-validation-for="LastDonationDate" class="text-red-600 text-xs"></span>
                    </div>
                </div>
            </section>
            <div class="h-px bg-gray-100 dark:bg-white/5"></div>
            <section>
                <div class="flex items-center gap-3 mb-5 text-gray-900 dark:text-white">
                    <div class="flex items-center justify-center size-8 rounded-full bg-purple-50 dark:bg-purple-900/20 text-purple-600 dark:text-purple-400">
                        <span class="material-symbols-outlined text-[18px]">lock</span>
                    </div>
                    <h3 class="text-lg font-semibold">Privacy &amp; Location</h3>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div class="space-y-1.5">
                        <label class="text-sm font-medium text-gray-700 dark:text-gray-300" asp-for="LocationId">City / Region <span class="text-red-500">*</span></label>
                        <select asp-for="LocationId" class="w-full rounded-lg border-gray-300 dark:border-white/20 dark:bg-white/5 shadow-sm focus:border-primary focus:ring-primary sm:text-sm py-2.5 transition-shadow">
                            <option value="">Select Region...</option>
                            @foreach (var location in Model.Locations)
                            {
                                <option value="@location.LocationId">@location.Districts</option>
                            }
                        </select>
                        <span asp-validation-for="LocationId" class="text-red-600 text-xs"></span>
                    </div>
                    <div class="flex items-center justify-between p-4 rounded-lg border border-gray-200 dark:border-white/10 bg-gray-50 dark:bg-white/5">
                        <div class="space-y-0.5">
                            <label class="text-sm font-medium text-gray-900 dark:text-white" asp-for="IsIdentityHidden">Hide Identity</label>
                            <p class="text-xs text-gray-500">Keep donor identity anonymous in public lists</p>
                        </div>
                        <label class="relative inline-flex items-center cursor-pointer">
                            <input asp-for="IsIdentityHidden" class="sr-only peer" type="checkbox" />
                            <div class="w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-primary/20 dark:peer-focus:ring-primary/30 rounded-full peer dark:bg-gray-700 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all dark:border-gray-600 peer-checked:bg-primary"></div>
                        </label>
                    </div>
                    <div class="flex items-center justify-between p-4 rounded-lg border border-gray-200 dark:border-white/10 bg-gray-50 dark:bg-white/5">
                        <div class="space-y-0.5">
                            <label class="text-sm font-medium text-gray-900 dark:text-white" asp-for="IsHealthyForDonation">Is Healthy for Donation</label>
                            <p class="text-xs text-gray-500">Confirm donor is eligible to donate</p>
                        </div>
                        <label class="relative inline-flex items-center cursor-pointer">
                            <input asp-for="IsHealthyForDonation" class="sr-only peer" type="checkbox" />
                            <div class="w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-primary/20 dark:peer-focus:ring-primary/30 rounded-full peer dark:bg-gray-700 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all dark:border-gray-600 peer-checked:bg-primary"></div>
                        </label>
                    </div>
                    <div class="flex items-center justify-between p-4 rounded-lg border border-gray-200 dark:border-white/10 bg-gray-50 dark:bg-white/5">
                        <div class="space-y-0.5">
                            <label class="text-sm font-medium text-gray-900 dark:text-white" asp-for="IsAvailable">Is Available</label>
                            <p class="text-xs text-gray-500">Donor is currently available for donation</p>
                        </div>
                        <label class="relative inline-flex items-center cursor-pointer">
                            <input asp-for="IsAvailable" class="sr-only peer" type="checkbox" />
                            <div class="w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-primary/20 dark:peer-focus:ring-primary/30 rounded-full peer dark:bg-gray-700 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all dark:border-gray-600 peer-checked:bg-primary"></div>
                        </label>
                    </div>
                </div>
            </section>
            <div class="flex items-center justify-end gap-4 pt-6 mt-8 border-t border-gray-100 dark:border-white/5">
                <a href="@Url.Action("DonorManagement", "Admin")" class="px-6 py-2.5 rounded-lg border border-gray-300 dark:border-white/10 text-gray-700 dark:text-gray-300 bg-white dark:bg-white/5 font-medium text-sm hover:bg-gray-50 dark:hover:bg-white/10 focus:outline-none focus:ring-2 focus:ring-gray-200 transition-all">
                    Cancel
                </a>
                <button class="px-6 py-2.5 rounded-lg bg-primary text-white font-medium text-sm shadow-md shadow-primary/20 hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-primary focus:ring-offset-2 transition-all active:scale-95" type="submit">
                    @(ViewBag.DonorId != null ? "Update Donor" : "Save Donor")
                </button>
            </div>
        </form>
    </div>
</div>


@section Scripts {
    <script src="https://cdn.jsdelivr.net/npm/jquery@3.7.1/dist/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/jquery-validation@1.19.5/dist/jquery.validate.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/jquery-validation-unobtrusive@3.2.12/dist/jquery.validate.unobtrusive.min.js"></script>
}

@using System.Security.Claims

@{
    var firstName = User.FindFirst("FirstName")?.Value ?? "";
    var firstLetter = !string.IsNullOrEmpty(firstName) ? firstName[0].ToString().ToUpper() : "U";
    var pageTitle = ViewData["Title"]?.ToString() ?? "Dashboard";
}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>@pageTitle - BloodConnect</title>
    <link rel="stylesheet" href="~/lib/bootstrap/dist/css/bootstrap.min.css" />
    <link rel="stylesheet" href="~/css/site.css" asp-append-version="true" />
    <link rel="stylesheet" href="~/BloodDonation.styles.css" asp-append-version="true" />

    <script src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js" defer></script>
    <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;900&display=swap" rel="stylesheet" />
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" rel="stylesheet" />
    <style>
        .material-symbols-outlined {
            font-variation-settings: 'FILL' 0, 'wght' 400, 'GRAD' 0, 'opsz' 24
        }
        body {
            font-family: 'Inter', sans-serif;
        }
    </style>
    <script>
        tailwind.config = {
            darkMode: "class",
            theme: {
                extend: {
                    colors: {
                        "primary": "#d70427",
                        "soft-red": "#ef4444",
                        "soft-gray": "#f8fafc"
                    },
                    fontFamily: {
                        "display": ["Inter", "sans-serif"]
                    },
                },
            },
        }
    </script>
</head>
<body class="bg-gray-100 font-display">

<div class="flex min-h-screen" x-data="{ sidebarOpen: false }">

    <!-- Mobile Sidebar Backdrop -->
    <div x-show="sidebarOpen"
         x-transition:enter="transition-opacity ease-linear duration-300"
         x-transition:enter-start="opacity-0"
         x-transition:enter-end="opacity-100"
         x-transition:leave="transition-opacity ease-linear duration-300"
         x-transition:leave-start="opacity-100"
         x-transition:leave-end="opacity-0"
         @@click="sidebarOpen = false"
         class="fixed inset-0 bg-gray-900/50 z-30 lg:hidden"></div>

    <!-- Sidebar (White) -->
    <aside :class="sidebarOpen ? 'translate-x-0' : '-translate-x-full lg:translate-x-0'"
           class="fixed inset-y-0 left-0 z-40 w-64 bg-white border-r border-gray-200 shadow-sm transform transition-transform duration-300 ease-in-out lg:relative lg:translate-x-0 flex flex-col">

        <!-- Close button for mobile -->
        <div class="flex items-center justify-end px-4 py-2 lg:hidden">
            <button @@click="sidebarOpen = false" class="text-gray-500 hover:text-gray-700">
                <span class="material-symbols-outlined">close</span>
            </button>
        </div>

        <!-- Sidebar Content (from partial) -->
        <partial name="_Sidebar" />
    </aside>

    <!-- Main Content Area -->
    <div class="flex-1 flex flex-col min-h-screen lg:ml-0">

        <!-- Top Header Bar -->
        <header class="bg-white shadow-sm border-b border-gray-200 px-6 py-4 flex items-center justify-between sticky top-0 z-20">
            <!-- Mobile Menu Toggle -->
            <button @@click="sidebarOpen = true"
                    class="lg:hidden text-gray-500 hover:text-gray-700 focus:outline-none mr-4">
                <span class="material-symbols-outlined text-2xl">menu</span>
            </button>

            <!-- Page Title -->
            <h2 class="text-xl font-semibold text-gray-800">@pageTitle</h2>

            <!-- Right Side Items -->
            <div class="flex items-center gap-4 ml-auto">
                <!-- Notification Bell -->
                <button class="relative p-2 text-gray-500 hover:text-gray-700 hover:bg-gray-100 rounded-full transition-colors">
                    <span class="material-symbols-outlined">notifications</span>
                    <span class="absolute top-1 right-1 w-2 h-2 bg-red-500 rounded-full"></span>
                </button>

                <!-- User Avatar -->
                <a asp-controller="Account" asp-action="Profile"
                   class="flex items-center gap-3 group">
                    <div class="w-10 h-10 bg-teal-500 rounded-full flex items-center justify-center text-white font-semibold text-sm shadow-md group-hover:ring-2 group-hover:ring-teal-300 transition-all">
                        @firstLetter
                    </div>
                </a>
            </div>
        </header>

        <!-- Page Content -->
        <main class="flex-1 p-6 lg:p-8 bg-gray-100 overflow-x-hidden">
            @RenderBody()
        </main>
    </div>
</div>

<script src="~/lib/jquery/dist/jquery.min.js"></script>
<script src="~/lib/bootstrap/dist/js/bootstrap.bundle.min.js"></script>
<script src="~/js/site.js" asp-append-version="true"></script>
@await RenderSectionAsync("Scripts", required: false)
</body>
</html>

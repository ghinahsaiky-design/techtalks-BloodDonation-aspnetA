@model BloodDonation.Models.RegisterViewModel

@{
    Layout = "~/Views/Shared/_AuthLayout.cshtml";
    ViewData["Title"] = "Sign Up";
}

<link rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">

<style>
    body {
        background: linear-gradient(135deg, #f8f9fa, #ffffff);
        margin-top: 100px;
    }

    .auth-wrapper {
        min-height: 100vh;
        background-color: #faf7f8;
    }

    .auth-card {
        background: rgba(255,255,255,0.95);
        backdrop-filter: blur(14px);
        border-radius: 28px;
        box-shadow: 0 25px 60px rgba(0,0,0,.08);
    }

    .input-group {
        border-radius: 999px;
        overflow: hidden;
        border: 1px solid #e5e7eb;
        transition: .2s ease;
    }

        .input-group:focus-within {
            border-color: #E94E4E;
            box-shadow: 0 0 0 3px rgba(233,78,78,.18);
        }

        .input-group.error {
            border-color: #dc3545;
        }

            .input-group.error:focus-within {
                border-color: #dc3545;
                box-shadow: 0 0 0 3px rgba(220,53,69,.18);
            }

    .form-control,
    .form-select {
        border: none;
        border-radius: 999px !important;
        padding: .9rem 1.2rem;
        box-shadow: none !important;
    }

    .input-group-text {
        background: transparent;
        border: none;
        color: #9ca3af;
        padding-left: 1.2rem;
        font-size: 1.1rem;
    }

    .form-check-input:checked {
        background-color: #E94E4E;
        border-color: #E94E4E;
    }

    .btn-main {
        background: linear-gradient(135deg, #E94E4E, #ff6b6b);
        border: none;
        border-radius: 999px;
        padding: .9rem;
        font-weight: 600;
        color: white;
    }

    .login-link {
        color: #E94E4E;
        font-weight: 500;
        text-decoration: none;
    }
</style>

<div class="auth-wrapper d-flex justify-content-center align-items-center">
    <div class="auth-card p-4 p-md-5 w-100" style="max-width:480px;">

        <h2 class="fw-bold text-center mb-1">Create Account</h2>
        <p class="text-muted text-center mb-4">Join BloodConnect and save lives</p>

        <form asp-action="SignUp" method="post">
            <!-- First Name -->
            <div class="mb-3">
                <div class="input-group">
                    <span class="input-group-text"><i class="bi bi-person"></i></span>
                    <input asp-for="FirstName" class="form-control" placeholder="First Name" />
                </div>
                <span asp-validation-for="FirstName" class="text-danger small d-block mt-1 ms-2"></span>
            </div>

            <!-- Last Name -->
            <div class="mb-3">
                <div class="input-group">
                    <span class="input-group-text"><i class="bi bi-person"></i></span>
                    <input asp-for="LastName" class="form-control" placeholder="Last Name" />
                </div>
                <span asp-validation-for="LastName" class="text-danger small d-block mt-1 ms-2"></span>
            </div>

            <!-- Email -->
            <div class="mb-3">
                <div class="input-group">
                    <span class="input-group-text"><i class="bi bi-at"></i></span>
                    <input asp-for="Email" type="email" class="form-control" placeholder="Email Address" />
                </div>
                <span asp-validation-for="Email" class="text-danger small d-block mt-1 ms-2"></span>
            </div>

            <!-- Password -->
            <div class="mb-3">
                <div class="input-group">
                    <span class="input-group-text">
                        <i class="bi bi-lock"></i>
                    </span>

                    <input asp-for="Password"
                           id="password"
                           type="password"
                           class="form-control"
                           placeholder="Password (min 6 characters)"
                           autocomplete="off"/>


                </div>

                <span asp-validation-for="Password"
                      class="text-danger small d-block mt-1 ms-2"></span>
            </div>

            <!-- Confirm Password -->

            <div class="mb-3">
                <div class="input-group">
                    <span class="input-group-text">
                        <i class="bi bi-lock"></i>
                    </span>

                    <input asp-for="ConfirmPassword"
                           id="confirmPassword"
                           type="password"
                           class="form-control"
                           placeholder="Confirm Password" />

                </div>

                <span asp-validation-for="ConfirmPassword"
                      class="text-danger small d-block mt-1 ms-2"></span>
            </div>

            <!-- Phone -->
            <div class="mb-3">
                <div class="input-group">
                    <span class="input-group-text"><i class="bi bi-telephone"></i></span>
                    <input asp-for="Phone" class="form-control" type="tel" pattern="[0-9]*" placeholder="Phone Number (optional)" />
                </div>
                <span asp-validation-for="Phone" class="text-danger small d-block mt-1 ms-2"></span>
            </div>

            <!-- Date of Birth -->
            <div class="mb-3">
                <div class="input-group">
                    <span class="input-group-text"><i class="bi bi-calendar-event"></i></span>
                    <input asp-for="DateOfBirth" type="date" class="form-control" max="@DateTime.Now.ToString("yyyy-MM-dd")" />
                </div>
                <span asp-validation-for="DateOfBirth" class="text-danger small d-block mt-1 ms-2"></span>
            </div>

            <!-- Gender -->
            <div class="mb-3">
                <div class="input-group">
                    <span class="input-group-text"><i class="bi bi-gender-ambiguous"></i></span>
                    <select asp-for="Gender" class="form-select">
                        <option value="">Select Gender</option>
                        <option>Male</option>
                        <option>Female</option>
                    </select>
                </div>
                <span asp-validation-for="Gender" class="text-danger small d-block mt-1 ms-2"></span>
            </div>

            <!-- Location & Blood -->
            <div class="row mb-3 g-2">
                <div class="col-6">
                    <div class="input-group">
                        <span class="input-group-text"><i class="bi bi-geo-alt"></i></span>
                        <select asp-for="LocationId" class="form-select">
                            <option value="">Location</option>
                            @foreach (var l in Model.Locations.OrderBy(a => a.Districts))
                            {
                                <option value="@l.LocationId">@l.Districts</option>
                            }
                        </select>
                    </div>
                    <span asp-validation-for="LocationId" class="text-danger small d-block mt-1 ms-2"></span>
                </div>

                <div class="col-6">
                    <div class="input-group">
                        <span class="input-group-text"><i class="bi bi-droplet-fill"></i></span>
                        <select asp-for="BloodTypeId" class="form-select">
                            <option value="">Blood Type</option>
                            @foreach (var b in Model.BloodTypes)
                            {
                                <option value="@b.BloodTypeId">@b.Type</option>
                            }
                        </select>
                    </div>
                    <span asp-validation-for="BloodTypeId" class="text-danger small d-block mt-1 ms-2"></span>
                </div>
            </div>

            <!-- Checkboxes -->
            <div class="form-check mb-2">
                <input asp-for="IsHealthyForDonation" class="form-check-input" />
                <label class="form-check-label">I am eligible to donate blood</label>
            </div>

            <div class="form-check mb-4">
                <input asp-for="IsIdentityHidden" class="form-check-input" />
                <label class="form-check-label">Hide my identity</label>
            </div>

            <button type="submit" class="btn btn-main w-100">
                Create Account
            </button>

            <p class="text-center mt-3 small">
                Already have an account?
                <a asp-controller="Auth" asp-action="Login" class="login-link">Log In</a>
            </p>

            <div class="text-center mt-3 pt-3 border-top">
                <p class="small text-muted mb-2">Are you a hospital or medical institution?</p>
                <a asp-controller="Hospital" asp-action="Registration" class="login-link">
                    <i class="bi bi-hospital"></i> Register as Hospital
                </a>
            </div>
        </form>
    </div>
</div>

@section Scripts {
    <partial name="_ValidationScriptsPartial" />
    <script>
        // Set max date for date of birth to today
        document.addEventListener('DOMContentLoaded', function() {
            const dateOfBirthInput = document.querySelector('input[name="DateOfBirth"]');
            if (dateOfBirthInput) {
                const today = new Date().toISOString().split('T')[0];
                dateOfBirthInput.setAttribute('max', today);
            }

            // Add error styling to input groups with validation errors
            function updateErrorStyles() {
                document.querySelectorAll('span.field-validation-error, span[data-valmsg-for]').forEach(function(span) {
                    if (span.textContent.trim() !== '') {
                        const inputGroup = span.closest('.mb-3')?.querySelector('.input-group');
                        if (inputGroup) {
                            inputGroup.classList.add('error');
                        }
                    } else {
                        const inputGroup = span.closest('.mb-3')?.querySelector('.input-group');
                        if (inputGroup) {
                            inputGroup.classList.remove('error');
                        }
                    }
                });
            }

            // Update error styles on page load
            setTimeout(updateErrorStyles, 100);

            // Real-time validation feedback
            document.querySelectorAll('input, select').forEach(function(input) {
                input.addEventListener('blur', function() {
                    setTimeout(updateErrorStyles, 100);
                });
            });

            // Watch for validation changes
            const form = document.querySelector('form');
            if (form) {
                const observer = new MutationObserver(function() {
                    updateErrorStyles();
                });
                observer.observe(form, { childList: true, subtree: true, characterData: true });
            }
        });

        function togglePassword(inputId, eyeId) {
            const input = document.getElementById(inputId);
            const eye = document.getElementById(eyeId);

            if (input.type === "password") {
                input.type = "text";
                eye.classList.remove("bi-eye-slash");
                eye.classList.add("bi-eye");
            } else {
                input.type = "password";
                eye.classList.remove("bi-eye");
                eye.classList.add("bi-eye-slash");
            }
        }

    </script>
}
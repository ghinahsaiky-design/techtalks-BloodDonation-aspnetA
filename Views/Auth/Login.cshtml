@model BloodDonation.Models.LoginViewModel

@{
    Layout = "~/Views/Shared/_AuthLayout.cshtml";
    ViewData["Title"] = "Login";
}

<link rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">

<style>
    body {
        background: linear-gradient(135deg, #f8f9fa, #ffffff);
        margin-top: 100px;
    }

    .auth-wrapper {
        min-height: 100vh;
        background-color: #faf7f8;
    }

    .auth-card {
        background: rgba(255,255,255,0.95);
        backdrop-filter: blur(14px);
        border-radius: 28px;
        box-shadow: 0 25px 60px rgba(0,0,0,.08);
    }

    .input-group {
        border-radius: 999px;
        overflow: hidden;
        border: 1px solid #e5e7eb;
        transition: .2s ease;
    }

        .input-group:focus-within {
            border-color: #E94E4E;
            box-shadow: 0 0 0 3px rgba(233,78,78,.18);
        }

    .input-group.error {
        border-color: #dc3545;
    }

    .input-group.error:focus-within {
        border-color: #dc3545;
        box-shadow: 0 0 0 3px rgba(220,53,69,.18);
    }

    .form-control {
        border: none;
        border-radius: 999px !important;
        padding: .9rem 1.2rem;
        box-shadow: none !important;
    }

    .input-group-text {
        background: transparent;
        border: none;
        color: #9ca3af;
        padding-left: 1.2rem;
        font-size: 1.1rem;
    }

    .btn-main {
        background: linear-gradient(135deg, #E94E4E, #ff6b6b);
        border: none;
        border-radius: 999px;
        padding: .9rem;
        font-weight: 600;
        color: white;
    }

    .login-link {
        color: #E94E4E;
        font-weight: 500;
        text-decoration: none;
    }
</style>

<div class="auth-wrapper d-flex justify-content-center align-items-center">
    <div class="auth-card p-4 p-md-5 w-100" style="max-width:480px;">

        <h2 class="fw-bold text-center mb-1">Welcome Back</h2>
        <p class="text-muted text-center mb-4">Log in to your account to continue</p>

        <div asp-validation-summary="ModelOnly" class="text-danger mb-3"></div>

        <form asp-action="Login" method="post">
            <!-- Email -->
            <div class="mb-3">
                <div class="input-group">
                    <span class="input-group-text"><i class="bi bi-at"></i></span>
                    <input asp-for="Email" type="email" class="form-control" placeholder="Email Address" />
                </div>
                <span asp-validation-for="Email" class="text-danger small d-block mt-1 ms-2"></span>
            </div>

            <!-- Password -->
            <div class="mb-3">
                <div class="input-group">
                    <span class="input-group-text"><i class="bi bi-lock"></i></span>
                    <input asp-for="Password" type="password" class="form-control" placeholder="Password" autocomplete="off" />
                </div>
                <span asp-validation-for="Password" class="text-danger small d-block mt-1 ms-2"></span>
            </div>

            <button type="submit" class="btn btn-main w-100">
                Login
            </button>

            <p class="text-center mt-3 small">
                Don't have an account?
                <a asp-controller="Auth" asp-action="SignUp" class="login-link">Create an account</a>
            </p>
            
            <div class="text-center mt-3 pt-3 border-top">
                <p class="small text-muted mb-2">Are you a hospital or medical institution?</p>
                <a asp-controller="Hospital" asp-action="Registration" class="login-link">
                    <i class="bi bi-hospital"></i> Register as Hospital
                </a>
            </div>
        </form>
    </div>
</div>

@section Scripts {
    <partial name="_ValidationScriptsPartial" />
    <script>
        // Add error styling to input groups with validation errors
        function updateErrorStyles() {
            document.querySelectorAll('span.field-validation-error, span[data-valmsg-for]').forEach(function(span) {
                if (span.textContent.trim() !== '') {
                    const inputGroup = span.closest('.mb-3')?.querySelector('.input-group');
                    if (inputGroup) {
                        inputGroup.classList.add('error');
                    }
                } else {
                    const inputGroup = span.closest('.mb-3')?.querySelector('.input-group');
                    if (inputGroup) {
                        inputGroup.classList.remove('error');
                    }
                }
            });
        }

        document.addEventListener('DOMContentLoaded', function() {
            // Update error styles on page load
            setTimeout(updateErrorStyles, 100);

            // Real-time validation feedback
            document.querySelectorAll('input').forEach(function(input) {
                input.addEventListener('blur', function() {
                    setTimeout(updateErrorStyles, 100);
                });
            });

            // Watch for validation changes
            const form = document.querySelector('form');
            if (form) {
                const observer = new MutationObserver(function() {
                    updateErrorStyles();
                });
                observer.observe(form, { childList: true, subtree: true, characterData: true });
            }
        });
    </script>
}

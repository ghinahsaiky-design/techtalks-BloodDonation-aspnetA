@model BloodDonation.Models.HospitalRequestsViewModel
@{
    Layout = "_HospitalLayout";
    ViewData["Title"] = "My Requests";
}

<main class="flex-1 overflow-y-auto p-8">
<div class="max-w-[1200px] mx-auto flex flex-col gap-6">
        <!-- Search and Filter -->
<div class="flex flex-col lg:flex-row justify-between items-start lg:items-center gap-4 bg-white dark:bg-[#1a1a1a] p-4 rounded-xl border border-gray-200 dark:border-gray-800 shadow-sm">
            <form method="get" asp-action="ViewRequests" class="flex flex-wrap items-center gap-3 w-full lg:w-auto">
<div class="relative w-full sm:w-64">
<span class="material-symbols-outlined absolute left-3 top-1/2 -translate-y-1/2 text-gray-400 text-xl">search</span>
                    <input name="searchQuery" value="@Model.SearchQuery" class="w-full pl-10 pr-4 py-2.5 rounded-lg border border-gray-200 dark:border-gray-700 bg-gray-50 dark:bg-white/5 text-sm focus:ring-primary focus:border-primary dark:text-white dark:placeholder-gray-500" placeholder="Search Request ID..." type="text"/>
</div>
                <input type="hidden" name="statusFilter" value="@Model.StatusFilter" />
                <input type="hidden" name="page" value="1" />
                <button type="submit" class="flex-1 sm:flex-none flex items-center justify-center gap-2 px-4 py-2.5 bg-primary text-white rounded-lg text-sm font-medium hover:bg-primary/90 transition-colors">
                    <span class="material-symbols-outlined text-lg">search</span>
                    Search
                                </button>
            </form>
            
            <!-- Status Filters -->
            <div class="flex items-center gap-2 overflow-x-auto max-w-full pb-1 lg:pb-0">
                <a asp-action="ViewRequests" asp-route-statusFilter="All" asp-route-searchQuery="@Model.SearchQuery" class="px-3 py-1.5 rounded-full text-xs font-bold @(Model.StatusFilter == "All" ? "bg-primary text-white" : "bg-gray-100 dark:bg-white/5 text-gray-600 dark:text-gray-400 hover:bg-gray-200 dark:hover:bg-white/10 transition-colors whitespace-nowrap")">
                    All Requests
                </a>
                <a asp-action="ViewRequests" asp-route-statusFilter="Pending" asp-route-searchQuery="@Model.SearchQuery" class="px-3 py-1.5 rounded-full text-xs font-bold @(Model.StatusFilter == "Pending" ? "bg-primary text-white" : "bg-gray-100 dark:bg-white/5 text-gray-600 dark:text-gray-400 hover:bg-gray-200 dark:hover:bg-white/10 transition-colors whitespace-nowrap")">
                    Pending (@(Model.StatusCounts.GetValueOrDefault("Pending", 0)))
                </a>
                <a asp-action="ViewRequests" asp-route-statusFilter="Approved" asp-route-searchQuery="@Model.SearchQuery" class="px-3 py-1.5 rounded-full text-xs font-bold @(Model.StatusFilter == "Approved" ? "bg-primary text-white" : "bg-gray-100 dark:bg-white/5 text-gray-600 dark:text-gray-400 hover:bg-gray-200 dark:hover:bg-white/10 transition-colors whitespace-nowrap")">
                    Approved (@(Model.StatusCounts.GetValueOrDefault("Approved", 0)))
                </a>
                <a asp-action="ViewRequests" asp-route-statusFilter="Completed" asp-route-searchQuery="@Model.SearchQuery" class="px-3 py-1.5 rounded-full text-xs font-bold @(Model.StatusFilter == "Completed" ? "bg-primary text-white" : "bg-gray-100 dark:bg-white/5 text-gray-600 dark:text-gray-400 hover:bg-gray-200 dark:hover:bg-white/10 transition-colors whitespace-nowrap")">
                    Completed (@(Model.StatusCounts.GetValueOrDefault("Completed", 0)))
                </a>
                <a asp-action="ViewRequests" asp-route-statusFilter="Cancelled" asp-route-searchQuery="@Model.SearchQuery" class="px-3 py-1.5 rounded-full text-xs font-bold @(Model.StatusFilter == "Cancelled" ? "bg-primary text-white" : "bg-gray-100 dark:bg-white/5 text-gray-600 dark:text-gray-400 hover:bg-gray-200 dark:hover:bg-white/10 transition-colors whitespace-nowrap")">
                    Cancelled (@(Model.StatusCounts.GetValueOrDefault("Cancelled", 0)))
                </a>
</div>
</div>
                
        <!-- Requests Table -->
<div class="bg-white dark:bg-[#1a1a1a] rounded-xl border border-gray-200 dark:border-gray-800 shadow-sm overflow-hidden">
            @if (Model.Requests.Any())
            {
<div class="overflow-x-auto">
<table class="w-full text-left border-collapse">
<thead>
<tr class="border-b border-gray-200 dark:border-gray-800 text-xs uppercase text-gray-500 font-semibold bg-gray-50 dark:bg-white/5">
<th class="px-6 py-4 whitespace-nowrap">Request ID</th>
<th class="px-6 py-4 whitespace-nowrap">Blood Type</th>
                                <th class="px-6 py-4 whitespace-nowrap">Patient Name</th>
                                <th class="px-6 py-4 whitespace-nowrap">Urgency</th>
                                <th class="px-6 py-4 whitespace-nowrap">Status</th>
                                <th class="px-6 py-4 whitespace-nowrap">Date Submitted</th>
                                <th class="px-6 py-4 whitespace-nowrap">Actions</th>
                            </tr>
</thead>
<tbody class="divide-y divide-gray-100 dark:divide-gray-800">
                            @foreach (var request in Model.Requests)
                            {
<tr class="hover:bg-gray-50 dark:hover:bg-white/5 transition-colors group">
                                    <td class="px-6 py-4 font-bold text-[#181112] dark:text-white whitespace-nowrap">#REQ-@request.RequestId</td>
<td class="px-6 py-4 whitespace-nowrap">
                                        <span class="inline-flex items-center justify-center w-8 h-8 rounded-full bg-red-100 text-red-700 font-bold text-xs dark:bg-red-900/30 dark:text-red-400 border border-red-200 dark:border-red-900/50">
                                            @(request.BloodType?.Type ?? "?")
                                            </span>
</td>
                                    <td class="px-6 py-4 text-sm font-medium text-gray-700 dark:text-gray-300 whitespace-nowrap">@request.PatientName</td>
<td class="px-6 py-4 whitespace-nowrap">
                                        @{
                                            var urgencyClass = request.UrgencyLevel?.ToLower() switch
                                            {
                                                "critical" => "bg-red-50 text-red-600 dark:bg-red-900/20 dark:text-red-400 dark:border-red-900/30 border border-red-100",
                                                "urgent" => "bg-orange-50 text-orange-600 dark:bg-orange-900/20 dark:text-orange-400 dark:border-orange-900/30 border border-orange-100",
                                                _ => "primary-badge-routine"
                                            };
                                        }
                                        <span class="inline-flex items-center gap-1.5 px-2.5 py-1 rounded-md text-xs font-bold @urgencyClass" style="@(request.UrgencyLevel?.ToLower() != "critical" && request.UrgencyLevel?.ToLower() != "urgent" ? "background-color: rgba(233, 78, 78, 0.1); color: #E94E4E; border: 1px solid rgba(233, 78, 78, 0.2);" : "")">
                                            @request.UrgencyLevel
                                            </span>
</td>
<td class="px-6 py-4 whitespace-nowrap">
                                        @{
                                            var statusClass = request.Status?.ToLower() switch
                                            {
                                                "completed" => "bg-green-50 text-green-700 dark:bg-green-900/20 dark:text-green-400 dark:border-green-900/30 border border-green-100",
                                                "approved" => "",
                                                "cancelled" => "bg-gray-100 text-gray-600 dark:bg-gray-800 dark:text-gray-400 dark:border-gray-700 border border-gray-200",
                                                _ => "bg-yellow-50 text-yellow-700 dark:bg-yellow-900/20 dark:text-yellow-400 dark:border-yellow-900/30 border border-yellow-100"
                                            };
                                            var statusStyle = request.Status?.ToLower() == "approved" ? "background-color: rgba(233, 78, 78, 0.1); color: #E94E4E; border: 1px solid rgba(233, 78, 78, 0.2);" : "";
                                        }
                                        <span class="inline-flex items-center gap-1.5 px-2.5 py-1 rounded-full text-xs font-medium @statusClass" style="@statusStyle">
                                            @if (request.Status == "Pending")
                                            {
                                                <span class="size-1.5 rounded-full bg-yellow-500 @(request.UrgencyLevel == "Critical" ? "animate-pulse" : "")"></span>
                                            }
                                            @request.Status
                                            </span>
</td>
                                    <td class="px-6 py-4 text-gray-500 text-sm whitespace-nowrap">
                                        @request.CreatedAt.ToString("MMM dd, yyyy")
                                        <span class="text-xs ml-1 bg-gray-100 dark:bg-gray-800 px-1.5 rounded text-gray-400">@request.CreatedAt.ToString("hh:mm tt")</span>
                                    </td>
                                    <td class="px-6 py-4 whitespace-nowrap">
                                        @if (request.Status == "Approved" || request.Status == "Completed")
                                        {
                                            <a asp-action="ViewMatchedDonors" asp-route-requestId="@request.RequestId" class="inline-flex items-center gap-1.5 px-3 py-1.5 rounded-lg text-xs font-semibold bg-primary/10 text-primary hover:bg-primary/20 transition-colors">
                                                <span class="material-symbols-outlined text-sm">people</span>
                                                View Donors
                                            </a>
                                        }
                                    </td>
                                </tr>
                            }
</tbody>
</table>
</div>
                        
                <!-- Pagination -->
                @if (Model.TotalPages > 1)
                {
<div class="px-6 py-4 border-t border-gray-200 dark:border-gray-800 flex flex-col sm:flex-row items-center justify-between gap-4">
                        <p class="text-sm text-gray-500 dark:text-gray-400">
                            Showing <span class="font-bold text-gray-900 dark:text-white">@((Model.CurrentPage - 1) * 10 + 1)</span> - <span class="font-bold text-gray-900 dark:text-white">@(Math.Min(Model.CurrentPage * 10, Model.TotalCount))</span> of <span class="font-bold text-gray-900 dark:text-white">@Model.TotalCount</span> requests
                        </p>
<div class="flex items-center gap-2">
                            @if (Model.CurrentPage > 1)
                            {
                                <a asp-action="ViewRequests" asp-route-page="@(Model.CurrentPage - 1)" asp-route-statusFilter="@Model.StatusFilter" asp-route-searchQuery="@Model.SearchQuery" class="px-4 py-2 text-sm font-medium border border-gray-200 dark:border-gray-700 rounded-lg text-gray-700 dark:text-gray-200 bg-white dark:bg-[#1a1a1a] hover:bg-gray-50 dark:hover:bg-white/5 transition-colors">
                                    Previous
                                </a>
                            }
                            else
                            {
                                <button disabled class="px-4 py-2 text-sm font-medium border border-gray-200 dark:border-gray-700 rounded-lg text-gray-500 dark:text-gray-400 bg-white dark:bg-[#1a1a1a] opacity-50 cursor-not-allowed">
                                    Previous
                                </button>
                            }
                            
                            @for (int i = 1; i <= Math.Min(Model.TotalPages, 5); i++)
                            {
                                <a asp-action="ViewRequests" asp-route-page="@i" asp-route-statusFilter="@Model.StatusFilter" asp-route-searchQuery="@Model.SearchQuery" class="w-9 h-9 flex items-center justify-center rounded-lg text-sm font-medium @(i == Model.CurrentPage ? "bg-primary text-white" : "text-gray-600 dark:text-gray-400 hover:bg-gray-50 dark:hover:bg-white/5 transition-colors")">
                                    @i
                                </a>
                            }
                            
                            @if (Model.CurrentPage < Model.TotalPages)
                            {
                                <a asp-action="ViewRequests" asp-route-page="@(Model.CurrentPage + 1)" asp-route-statusFilter="@Model.StatusFilter" asp-route-searchQuery="@Model.SearchQuery" class="px-4 py-2 text-sm font-medium border border-gray-200 dark:border-gray-700 rounded-lg text-gray-700 dark:text-gray-200 bg-white dark:bg-[#1a1a1a] hover:bg-gray-50 dark:hover:bg-white/5 transition-colors">
                                    Next
                                </a>
                            }
                            else
                            {
                                <button disabled class="px-4 py-2 text-sm font-medium border border-gray-200 dark:border-gray-700 rounded-lg text-gray-500 dark:text-gray-400 bg-white dark:bg-[#1a1a1a] opacity-50 cursor-not-allowed">
                                    Next
                                </button>
                            }
</div>
</div>
                }
            }
            else
            {
                <div class="p-8 text-center text-gray-500 dark:text-gray-400">
                    <p>No requests found. <a asp-action="CreateRequest" class="text-primary hover:underline">Create your first request</a></p>
                </div>
            }
</div>
</div>
</main>
